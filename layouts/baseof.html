<!doctype html>
<html lang="{{ site.Language.LanguageCode | default "en-GB" }}" class="scroll-smooth">
  <head>
    {{ partial "head/index.html" . }}
    <script>
        // Early theme application to avoid FOUC and ensure accessibility audit accuracy
        const savedTheme = localStorage.getItem('moduk_theme');
        if (savedTheme === 'light') {
            document.documentElement.classList.add('light');
            document.documentElement.classList.remove('dark');
        } else {
            // Default to dark
            document.documentElement.classList.remove('light');
            document.documentElement.classList.add('dark');
        }
    </script>
  </head>
  {{ $unit := .Params.unit | default .Section | default "sas" }}
  {{ $isRegistry := or (eq .Section "registry") (eq .Type "registry") (strings.HasPrefix .Layout "registry/") }}
  {{ if and $isRegistry (ne .Layout "registry/gate") (ne .Layout "registry/restricted") }}
    <script>
      if (localStorage.getItem('uksf_auth') !== 'authorized') {
        window.location.href = '/registry/gate/';
      }
    </script>
  {{ end }}
  <body class="unit-{{ .Params.unit | default .Section | default `global` }}">
    <!-- GLOBAL SYSTEM HUD (Fixed Components) -->
    <div class="fixed top-0 left-0 w-full z-[3000]">
        {{ partial "core/header.html" . }}
        {{ partial "core/phase-banner.html" . }}
    </div>

    <div id="main-content" role="main" class="flex-grow">
      {{ block "main" . }}{{ end }}
    </div>

    {{ if not .IsHome }}
      {{ partial "core/footer.html" . }}
    {{ end }}

    {{ $core := resources.Get "js/system-core.js" | fingerprint }}
    <script src="{{ $core.RelPermalink }}" integrity="{{ $core.Data.Integrity }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.initSystem) window.initSystem("{{ site.Params.discord.server_id }}");
        });
    </script>
    
    <script src="{{ `js/main.js` | relURL }}" defer></script>
    {{ partial "core/cookie-consent.html" . }}
  </body>
</html>
