<!doctype html>
<html lang="{{ site.Language.LanguageCode }}" class="scroll-smooth">
  <head>
    {{ partial "head/index.html" . }}
  </head>
  {{ $unit := .Params.unit | default .Section | default "sas" }}
  {{ $isRegistry := or (eq .Section "registry") (eq .Type "registry") (strings.HasPrefix .Layout "registry/") }}
  {{ if and $isRegistry (ne .Layout "registry/gate") (ne .Layout "registry/restricted") }}
    <script>
      if (localStorage.getItem('uksf_auth') !== 'authorized') {
        window.location.href = '/registry/gate/';
      }
    </script>
  {{ end }}
  <body class="unit-{{ .Params.unit | default .Section | default `global` }}">
    <!-- GLOBAL SYSTEM HUD (Fixed Components) -->
    <div class="fixed top-0 left-0 w-full z-[3000]">
        {{ partial "core/header.html" . }}
        {{ partial "core/phase-banner.html" . }}
    </div>

    <div id="main-content" role="main" class="flex-grow">
      {{ block "main" . }}{{ end }}
    </div>

    {{ if not .IsHome }}
      {{ partial "core/footer.html" . }}
    {{ end }}

    {{ $core := resources.Get "js/system-core.js" | fingerprint }}
    <script src="{{ $core.RelPermalink }}" integrity="{{ $core.Data.Integrity }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.initSystem) window.initSystem("{{ site.Params.discord.server_id }}");
            
            // Check for saved theme preference
            if (localStorage.getItem('moduk_theme') === 'dark' || (!localStorage.getItem('moduk_theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        });
    </script>
    
    <script src="{{ `js/main.js` | relURL }}" defer></script>
    {{ partial "core/cookie-consent.html" . }}
  </body>
</html>
