{{ define "main" }}
<div class="orbat-canvas-viewport">
    <!-- 1. System Overlay: Controls -->
    <div class="canvas-overlay top-left">
        <div class="flex items-center space-x-4">
            <a href="/archive/covert" class="btn-terminal !py-2 !px-4 text-[9px]">
                <span class="mr-2">←</span> RETURN_TO_DIRECTORATE
            </a>
            <div class="h-8 w-px bg-white/10"></div>
            <div class="flex flex-col">
                <span class="text-[10px] font-black text-white tracking-tighter uppercase">Institutional ORBAT</span>
                <span class="text-[7px] font-mono text-gray-500 uppercase tracking-widest">v2.1 // LIVE_SYNC</span>
            </div>
        </div>
    </div>

    <div class="canvas-overlay top-right text-right">
        <div class="font-mono text-[8px] text-gray-500 space-y-1 uppercase tracking-widest">
            <span class="block text-white font-black">Auth: JSFC_DIRECTORATE</span>
            <span class="block text-green-500">Integrity: VERIFIED</span>
            <span id="zoom-level">Zoom: 100%</span>
        </div>
    </div>

    <!-- HQ ADMIN INTERFACE -->
    <div id="hq-admin-bar" class="canvas-overlay bottom-left hidden">
        <div class="bracket-box bg-black/80 backdrop-blur-2xl border-[var(--primary)]/40 !p-8 space-y-8 shadow-[0_0_50px_rgba(179,153,93,0.1)] min-w-[300px]">
            <div class="flex items-center justify-between border-b border-white/10 pb-6">
                <div class="flex items-center space-x-4">
                    <span class="w-2.5 h-2.5 bg-red-600 rounded-full animate-pulse"></span>
                    <span class="text-xs font-black text-white tracking-[0.2em] uppercase">HQ_DIRECTORATE_ACCESS</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-4">
                <button onclick="toggleEditMode()" id="edit-mode-btn" class="btn-elite !py-4 !px-6 !text-xs w-full">
                    ENABLE_STRUCTURAL_EDIT
                </button>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="addOrbatNode()" class="btn-terminal !py-3 !text-[10px] !text-green-500 !border-green-500/20">
                        ADD_NEW_NODE
                    </button>
                    <button onclick="exportOrbatJSON()" class="btn-terminal !py-3 !text-[10px] !text-[var(--primary)] !border-[var(--primary)]/40">
                        EXPORT_DATA
                    </button>
                </div>
            </div>
            
            <p class="text-[8px] font-mono text-gray-600 uppercase italic leading-relaxed border-t border-white/5 pt-4">
                Institutional structural oversight enabled. Use with extreme caution.
            </p>
        </div>
    </div>

    <!-- Notification Overlay (Toasts) -->
    <div id="toast-container" class="fixed top-8 left-1/2 -translate-x-1/2 z-[6000] flex flex-col items-center space-y-3 pointer-events-none"></div>

    <!-- 2. Interactive Canvas -->
    <div id="orbat-canvas" class="orbat-canvas-container cursor-grab active:cursor-grabbing">
        <div id="canvas-content" class="orbat-canvas-content">
            {{ partial "widgets/orbat.html" . }}
        </div>
    </div>

    <!-- 3. Canvas Controls -->
    <div class="canvas-overlay bottom-right">
        <div class="flex flex-col space-y-2">
            <button onclick="adjustZoom(0.1)" class="btn-canvas-ctrl">+</button>
            <button onclick="resetCanvas()" class="btn-canvas-ctrl">⊙</button>
            <button onclick="adjustZoom(-0.1)" class="btn-canvas-ctrl">-</button>
        </div>
    </div>
</div>

<script src="{{ "js/orbat-canvas.js" | relURL }}"></script>
{{ end }}