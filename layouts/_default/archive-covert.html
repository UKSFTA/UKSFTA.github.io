{{ define "main" }}
<script>
    // Priority Authorization Check
    if (localStorage.getItem('uksf_auth') !== 'authorized') {
        window.location.href = '/restricted';
    }
</script>
{{ $units := .Site.Data.units }}
<!-- 1. SIS EXECUTIVE INTERFACE -->
<section class="bg-[var(--bg-page)] dark:bg-[#0b0c0c] border-b-8 border-mod-red relative overflow-hidden transition-colors duration-300">
    <!-- Background Branding -->
    <div class="absolute inset-0 z-0 opacity-[0.02] pointer-events-none flex items-center justify-center overflow-hidden">
        <span class="text-[30vw] font-industrial font-black leading-none uppercase">SIS</span>
    </div>

    <div class="moduk-width-container relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16 items-center">
            <div class="lg:col-span-8 space-y-10">
                <div class="inline-flex items-center gap-4 bg-mod-red/5 border border-mod-red/10 px-4 py-2">
                    <span class="w-2 h-2 bg-mod-red rounded-full animate-pulse"></span>
                    <span class="text-mod-red font-body font-bold text-xs uppercase tracking-[0.4em]">// SIS_DIRECTORATE_OVERRIDE</span>
                </div>
                
                <h1 class="text-6xl md:text-8xl lg:text-[9rem] font-industrial font-black uppercase leading-[0.85] tracking-tighter m-0">
                    Military <br/><span class="text-mod-red">Intelligence.</span>
                </h1>
                
                <div class="max-w-3xl border-l-8 border-mod-red pl-16 py-8 bg-[#f3f2f1]/50 dark:bg-[var(--bg-page)]/5 backdrop-blur-sm">
                    <p class="text-2xl lg:text-3xl font-body font-light leading-relaxed text-mod-grey-1 dark:text-white/80 italic m-0">
                        The Directorate coordinates clandestine assets, managing strategic SIGINT, HUMINT surveillance, and deniable operations across all simulation theaters.
                    </p>
                </div>
            </div>

            <div class="lg:col-span-4 hidden lg:block">
                <div class="card-mod border-t-8 border-t-mod-red space-y-8 bg-[var(--bg-page)]/50 dark:bg-[#1d2329]/50 backdrop-blur-xl shadow-2xl">
                    <div class="space-y-4 font-mono">
                        <span class="text-[10px] font-bold text-mod-grey-2 uppercase tracking-widest block">// Registry_Node</span>
                        <span class="text-3xl font-black text-mod-black dark:text-white uppercase font-industrial leading-none">SIS_HUB_01</span>
                    </div>
                    <div class="h-px bg-mod-grey-3 dark:bg-mod-grey-1"></div>
                    <div class="grid grid-cols-2 gap-6 font-mono text-[9px] font-bold uppercase tracking-widest">
                        <div class="space-y-1">
                            <span class="text-mod-grey-2">London HQ</span>
                            <span class="text-mod-black dark:text-white block clock-london">00:00:00</span>
                        </div>
                        <div class="space-y-1 text-right">
                            <span class="text-mod-grey-2">ZULU Time</span>
                            <span class="text-mod-black dark:text-white block clock-utc">00:00:00</span>
                        </div>
                        <div class="space-y-1">
                            <span class="text-mod-grey-2">Classification</span>
                            <span class="text-mod-red block">RESTRICTED</span>
                        </div>
                        <div class="space-y-1 text-right">
                            <span class="text-mod-grey-2">Status</span>
                            <span class="text-mod-green block">SYNCED</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function updateInterfaceClocks() {
        const now = new Date();
        const london = new Intl.DateTimeFormat('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'Europe/London' }).format(now);
        const utc = new Intl.DateTimeFormat('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'UTC' }).format(now);
        document.querySelectorAll('.clock-london').forEach((el) => (el.innerText = london));
        document.querySelectorAll('.clock-utc').forEach((el) => (el.innerText = utc));
    }
    setInterval(updateInterfaceClocks, 1000);
    updateInterfaceClocks();
</script>

<!-- 2. BRANCH REGISTRY -->
<section class="bg-mod-grey-4 dark:bg-mod-grey-1 border-y border-mod-grey-3 dark:border-mod-grey-1">
    <div class="moduk-width-container">
        <div class="flex flex-col lg:flex-row lg:items-end justify-between mb-16 border-b-4 border-mod-purple pb-10 gap-12">
            <div class="space-y-6">
                <div class="flex items-center gap-8">
                    {{ $intIcon := resources.Get "icons/Intelligence-Corps.png" }}
                    {{ if $intIcon }}
                        <img src="{{ $intIcon.RelPermalink }}" class="h-20 grayscale no-invert opacity-80" alt="Intelligence Corps"/>
                    {{ end }}
                    <div class="w-px h-16 bg-mod-grey-3 dark:bg-mod-grey-1"></div>
                    <div class="flex flex-col">
                        <span class="text-xs font-mono text-mod-purple dark:text-[#bfc1c3] uppercase tracking-[0.4em] font-black">Branch Registry</span>
                        <h2 class="text-6xl lg:text-7xl font-industrial font-black text-mod-black dark:text-white uppercase m-0 leading-none">Directorate S</h2>
                    </div>
                </div>
            </div>
            <p class="max-w-2xl text-mod-grey-1 dark:text-mod-grey-3 font-body text-lg leading-relaxed lg:text-right font-light italic">
                Institutional oversight of G2 intelligence, tactical Zeus coordination, and technical infrastructure protocols for Taskforce Alpha operations.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
            <div class="card-mod group flex flex-col justify-between h-[300px] border-b-8 border-b-mod-purple bg-[var(--bg-page)]">
                <div class="space-y-6">
                    <span class="text-[9px] font-mono text-mod-grey-2 font-black uppercase tracking-[0.3em] block border-b border-mod-grey-3 dark:border-mod-grey-1 pb-3">// Registry: G2_ZEUS</span>
                    <h4 class="text-3xl font-industrial font-black uppercase text-mod-black dark:text-white m-0 leading-tight">Battlespace Control</h4>
                    <p class="text-mod-grey-1 dark:text-mod-grey-3 text-sm leading-relaxed font-medium opacity-80">Management of real-time battlespace dynamics and narrative reactivity.</p>
                </div>
                <div class="pt-6 border-t border-mod-grey-3 dark:border-mod-grey-1 flex items-center justify-between">
                    <span class="text-[10px] font-body font-bold text-mod-purple dark:text-white uppercase tracking-[0.2em]">Active Station</span>
                    <svg class="w-5 h-5 text-mod-purple transition-transform group-hover:translate-x-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </div>
            </div>

            <div class="card-mod group flex flex-col justify-between h-[300px] border-b-8 border-b-mod-blue bg-[var(--bg-page)]">
                <div class="space-y-6">
                    <span class="text-[9px] font-mono text-mod-grey-2 font-black uppercase tracking-[0.3em] block border-b border-mod-grey-3 dark:border-mod-grey-1 pb-3">// Registry: G2_ANALYTICS</span>
                    <h4 class="text-3xl font-industrial font-black uppercase text-mod-black dark:text-white m-0 leading-tight">Intelligence Analysis</h4>
                    <p class="text-mod-grey-1 dark:text-mod-grey-3 text-sm leading-relaxed font-medium opacity-80">Development of operational dossiers, adversary ORBAT reports, and theater arcs.</p>
                </div>
                <div class="pt-6 border-t border-mod-grey-3 dark:border-mod-grey-1 flex items-center justify-between">
                    <span class="text-[10px] font-body font-bold text-mod-blue dark:text-white uppercase tracking-[0.2em]">Active Station</span>
                    <svg class="w-5 h-5 text-mod-blue transition-transform group-hover:translate-x-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </div>
            </div>

            <div class="card-mod group flex flex-col justify-between h-[300px] border-b-8 border-b-mod-red bg-[var(--bg-page)]">
                <div class="space-y-6">
                    <span class="text-[9px] font-mono text-mod-grey-2 font-black uppercase tracking-[0.3em] block border-b border-mod-grey-3 dark:border-mod-grey-1 pb-3">// Registry: QM_TECH</span>
                    <h4 class="text-3xl font-industrial font-black uppercase text-mod-black dark:text-white m-0 leading-tight">Technical Standards</h4>
                    <p class="text-mod-grey-1 dark:text-mod-grey-3 text-sm leading-relaxed font-medium opacity-80">Oversight of modpack integrity and mission scripting protocols.</p>
                </div>
                <div class="pt-6 border-t border-mod-grey-3 dark:border-mod-grey-1 flex items-center justify-between">
                    <span class="text-[10px] font-body font-bold text-mod-red dark:text-white uppercase tracking-[0.2em]">Active Station</span>
                    <svg class="w-5 h-5 text-mod-red transition-transform group-hover:translate-x-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 3. AOR CONTROL CENTER -->
<section id="intel-map-section" class="bg-[var(--bg-page)] !justify-start">
    <div class="moduk-width-container space-y-10">
        <div class="flex flex-col md:flex-row md:items-end justify-between border-b-4 border-mod-purple pb-8 gap-8">
            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <span class="w-3 h-3 bg-mod-red rounded-full animate-pulse shadow-sm"></span>
                    <span class="text-xs font-mono font-black text-mod-red uppercase tracking-[0.4em] block">// Strategic_Assets</span>
                </div>
                <h2 class="text-6xl lg:text-7xl font-industrial font-black text-mod-black dark:text-white uppercase m-0 leading-none">AOR Control Center</h2>
            </div>
            <div class="text-right hidden md:block font-mono space-y-2">
                <span class="block text-[9px] text-mod-grey-2 uppercase tracking-widest font-black">Projection: MERCATOR_SF_GRID</span>
                <span class="bg-mod-green text-white px-4 py-1.5 text-[10px] font-black uppercase tracking-widest shadow-lg">LIVE_SATELLITE_SYNC</span>
            </div>
        </div>

        <!-- Professional MOD Workstation Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-px bg-mod-grey-3 dark:bg-mod-grey-1 border border-mod-grey-3 dark:border-mod-grey-1 items-stretch overflow-hidden shadow-2xl h-[700px]">
            <!-- Left Sidebar: Tactical Context -->
            <div class="lg:col-span-3 flex flex-col bg-[var(--bg-page)] dark:bg-[#1d2329]">
                <div class="p-8 border-b border-mod-grey-3 dark:border-mod-grey-1 bg-mod-grey-4 dark:bg-mod-black/20">
                    <span class="text-[10px] font-black text-mod-purple dark:text-mod-grey-3 uppercase tracking-[0.4em] font-mono leading-none">Signal_Params</span>
                </div>
                <div class="flex-1 overflow-y-auto p-8 custom-scrollbar space-y-10 bg-[var(--bg-page)] dark:bg-[#1d2329]">
                    <div class="space-y-4">
                        <span class="text-[9px] text-mod-grey-2 uppercase font-black tracking-[0.3em] font-mono block border-b border-mod-grey-3 dark:border-mod-grey-1 pb-2">// Status</span>
                        <div class="bg-mod-grey-4 dark:bg-mod-black border border-mod-grey-3 dark:border-mod-grey-1 p-6 shadow-inner">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-[11px] text-mod-black dark:text-white font-black uppercase tracking-tight">Uplink</span>
                                <span class="text-[9px] text-mod-green font-black font-mono uppercase bg-mod-green/10 px-2 py-0.5">VERIFIED</span>
                            </div>
                            <div class="h-2 bg-mod-grey-3 dark:bg-mod-grey-1 w-full rounded-full overflow-hidden">
                                <div class="h-full bg-mod-green w-[94%] shadow-[0_0_10px_rgba(0,112,60,0.4)]"></div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <span class="text-[9px] text-mod-grey-2 uppercase font-black tracking-[0.3em] font-mono block border-b border-mod-grey-3 dark:border-mod-grey-1 pb-2">// System_Logs</span>
                        <div class="font-mono text-[9px] space-y-3 uppercase text-mod-grey-2 font-black italic">
                            <p class="m-0 text-mod-purple">[14:32:01] SIS_UPLINK_SYNC</p>
                            <p class="m-0">[14:32:05] SECTOR_7_SCAN</p>
                            <p class="m-0">[14:33:00] TELEMETRY_ACK</p>
                            <p class="m-0 text-mod-green">[14:34:12] NODE_HEALTH_100%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center: Tactical Map -->
            <div class="lg:col-span-6 flex flex-col relative bg-mod-grey-1">
                <!-- Layer Controls -->
                <div class="absolute bottom-10 left-10 flex flex-col gap-3 z-30">
                    <button onclick="toggleMapLayer('intel')" id="btn-intel-layer" class="bg-mod-black border border-mod-purple text-white font-mono font-black text-[10px] px-6 py-3 hover:bg-mod-purple transition-all uppercase shadow-2xl">Intel_Layer</button>
                    <button onclick="toggleMapLayer('uksf')" id="btn-uksf-layer" class="bg-mod-black border border-mod-grey-1 text-mod-grey-2 font-mono font-black text-[10px] px-6 py-3 hover:bg-mod-grey-1 transition-all uppercase shadow-2xl">Public_AOR</button>
                </div>

                <div class="relative flex-1 bg-mod-grey-3 flex items-center justify-center overflow-hidden shadow-inner group">
                    <div id="map-intel" class="absolute inset-0 flex items-center justify-center transition-opacity duration-500">
                        {{ $intel_map_path := site.Params.intelligence.intel_map_path | default "icons/intelligence-map.png" }}
                        {{ $mapIntel := resources.Get $intel_map_path }}
                        {{ if $mapIntel }}
                            <img src="{{ $mapIntel.RelPermalink }}" class="w-full h-full object-contain p-16 opacity-100 group-hover:scale-[1.02] transition-transform duration-[15s] ease-linear no-invert" alt="Intel Map"/>
                        {{ end }}
                    </div>
                    <div id="map-uksf" class="absolute inset-0 flex items-center justify-center transition-opacity duration-500 opacity-0 pointer-events-none">
                        {{ $uksfMap := resources.Get "icons/UKSF-MAP.png" }}
                        {{ if $uksfMap }}
                            <img src="{{ $uksfMap.RelPermalink }}" class="w-full h-full object-contain p-16 opacity-100 grayscale group-hover:scale-[1.02] transition-transform duration-[15s] ease-linear no-invert" alt="Public Map"/>
                        {{ end }}
                    </div>
                    
                    <!-- Grid Overlay -->
                    <div class="absolute inset-0 z-20 opacity-10 pointer-events-none" style="background-image: linear-gradient(to right, white 1px, transparent 1px), linear-gradient(to bottom, white 1px, transparent 1px); background-size: 50px 50px;"></div>
                </div>
            </div>

            <!-- Right Sidebar: Live Telemetry -->
            <div class="lg:col-span-3 flex flex-col bg-[var(--bg-page)] dark:bg-[#1d2329]">
                <div class="p-8 border-b border-mod-grey-3 dark:border-mod-grey-1 bg-mod-grey-4 dark:bg-mod-black/20">
                    <span class="text-[10px] font-black text-mod-purple dark:text-mod-grey-3 uppercase tracking-[0.4em] font-mono leading-none">Signal_Hub</span>
                </div>
                {{ partial "widgets/comms-hub.html" (dict "class" "h-full !border-0 !bg-transparent p-8") }}
            </div>
        </div>
    </div>
</section>

<script>
    window.toggleMapLayer = (layer) => {
        const intel = document.getElementById('map-intel');
        const uksf = document.getElementById('map-uksf');
        const btnIntel = document.getElementById('btn-intel-layer');
        const btnUksf = document.getElementById('btn-uksf-layer');
        
        if (layer === 'intel') {
            intel.classList.remove('opacity-0', 'pointer-events-none');
            uksf.classList.add('opacity-0', 'pointer-events-none');
            btnIntel.classList.remove('border-mod-grey-1', 'text-mod-grey-2');
            btnIntel.classList.add('border-mod-purple', 'text-white');
            btnUksf.classList.remove('border-mod-purple', 'text-white');
            btnUksf.classList.add('border-mod-grey-1', 'text-mod-grey-2');
        } else {
            uksf.classList.remove('opacity-0', 'pointer-events-none');
            intel.classList.add('opacity-0', 'pointer-events-none');
            btnUksf.classList.remove('border-mod-grey-1', 'text-mod-grey-2');
            btnUksf.classList.add('border-mod-purple', 'text-white');
            btnIntel.classList.remove('border-mod-purple', 'text-white');
            btnIntel.classList.add('border-mod-grey-1', 'text-mod-grey-2');
        }
    }
</script>
{{ end }}