{{ $orbat := .Site.Data.orbat_v2 }}
{{ $units := .Site.Data.units }}

<div class="orbat-canvas-area relative w-[5000px] h-[5000px]">
    <!-- Visual Grid Backdrop -->
    <div class="absolute inset-0 pointer-events-none opacity-[0.03]" 
         style="background-image: radial-gradient(var(--primary) 1px, transparent 1px); background-size: 50px 50px;"></div>

    <!-- SVG Connector Layer -->
    <svg id="orbat-connectors" class="absolute inset-0 w-full h-full pointer-events-none">
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="rgba(179, 153, 93, 0.5)" />
            </marker>
        </defs>
        {{ range $orbat.links }}
        <path class="orbat-link" data-source="{{ .source }}" data-target="{{ .target }}" 
              d="" fill="none" stroke="rgba(179, 153, 93, 0.3)" stroke-width="1.5" marker-end="url(#arrowhead)" />
        {{ end }}
        <path id="temp-link" d="" fill="none" stroke="var(--primary)" stroke-width="2" stroke-dasharray="5,5" class="hidden" />
    </svg>

    <!-- Node Layer -->
    <div id="orbat-nodes-layer" class="absolute inset-0">
        {{ range $orbat.nodes }}
        <div class="orbat-node-wrapper absolute transform -translate-x-1/2 -translate-y-1/2" 
             id="node-{{ .id }}" 
             style="left: calc(2500px + {{ .x }}px); top: calc(2500px + {{ .y }}px);"
             data-id="{{ .id }}"
             data-x="{{ .x }}"
             data-y="{{ .y }}">
            {{ partial "widgets/orbat-node.html" (dict "node" . "units" $units "Site" $.Site) }}
        </div>
        {{ end }}
    </div>
</div>