{{ define "main" }}
<section class="min-h-screen flex items-center justify-center bg-mod-black relative overflow-hidden">
    <!-- Institutional Background -->
    <div class="absolute inset-0 bg-grid-white opacity-[0.02] pointer-events-none"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-mod-black via-transparent to-mod-black"></div>
    
    <div class="moduk-width-container relative z-10 max-w-2xl w-full">
        <div class="bg-mod-dark-grey border border-mod-grey-1 p-16 shadow-[0_0_100px_rgba(0,0,0,0.5)] relative overflow-hidden rounded-sm backdrop-blur-xl">
            <!-- Top Identity Indicator -->
            <div class="absolute top-0 left-0 w-full h-2 bg-mod-grey-1"></div>
            <div class="absolute top-0 left-0 w-1/3 h-2 bg-mod-purple animate-pulse"></div>

            <div class="mb-16 space-y-10">
                <div class="flex items-center gap-8">
                    {{ $logo := resources.Get "icons/TFA.png" }}
                    {{ if $logo }}
                    <img src="{{ $logo.RelPermalink }}" alt="TFA" class="h-16 opacity-80 grayscale no-invert">
                    {{ end }}
                    <div class="h-12 w-px bg-mod-grey-1"></div>
                    <div class="flex flex-col">
                        <span class="text-[9px] font-mono text-mod-grey-2 uppercase tracking-[0.5em] font-black ">Defence Digital</span>
                        <span class="text-[9px] font-mono text-mod-purple dark:text-[#bfc1c3] uppercase tracking-[0.5em] font-black mt-1">JSFC_Node_Alpha</span>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <h1 class="text-5xl font-black tracking-tighter uppercase font-industrial text-white m-0 leading-none">Authorization</h1>
                    <p class="text-mod-grey-2 text-[11px] uppercase tracking-[0.4em] font-mono font-bold">Restricted Access Service // RAS_v4.2</p>
                </div>
            </div>

            <div id="terminal-interface" class="font-mono space-y-12">
                <div id="terminal-logs" class="space-y-4 text-mod-grey-2 text-[11px] leading-relaxed select-none border-l-4 border-mod-grey-1 pl-8">
                    <p class="italic opacity-60">// INITIALIZING_SECURE_HANDSHAKE...</p>
                    <p>> ESTABLISHING_TUNNEL: <span class="text-mod-green font-black">STABLE</span></p>
                    <p>> LOCAL_DTG: <span class="clock-utc text-white font-black">00:00:00Z</span></p>
                    <p class="text-white pt-6 font-black uppercase tracking-widest">Please enter authorization key:</p>
                </div>

                <div class="relative group pt-6">
                    <div class="flex items-center gap-8 border-b-2 border-mod-grey-1 pb-6 focus-within:border-mod-purple transition-all">
                        <span class="text-mod-purple font-black text-2xl animate-pulse">></span>
                        <input
                            type="text"
                            id="terminal-input"
                            placeholder="SERIAL_NUMBER"
                            class="bg-transparent border-none outline-none w-full text-white placeholder:text-white/10 uppercase tracking-[0.6em] text-sm font-black"
                            autocomplete="off"
                            autofocus
                        />
                    </div>
                </div>
            </div>

            <!-- Official Warning -->
            <div class="mt-20 p-8 bg-mod-red/5 border border-mod-red/10 space-y-6">
                <div class="flex items-center gap-4">
                    <span class="w-3 h-3 bg-mod-red rounded-full animate-pulse shadow-[0_0_15px_rgba(212,53,28,0.4)]"></span>
                    <span class="text-[10px] font-black text-mod-red uppercase tracking-[0.4em] font-mono">Security Warning</span>
                </div>
                <p class="text-[10px] font-mono text-mod-grey-2 uppercase tracking-[0.2em] leading-relaxed font-bold italic opacity-80">
                    Unauthorized access to this node is prohibited under the Computer Misuse Act 1990. 
                    Persistent SIGINT monitoring is in effect. All activity is logged and attributed.
                </p>
            </div>
        </div>
    </div>
</section>

<script>
    const input = document.getElementById('terminal-input');
    const logs = document.getElementById('terminal-logs');

    function updateGateClock() {
        const now = new Date();
        const utc = new Intl.DateTimeFormat('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'UTC' }).format(now);
        document.querySelectorAll('.clock-utc').forEach((el) => (el.innerText = utc + 'Z'));
    }
    setInterval(updateGateClock, 1000);
    updateGateClock();

    function addLog(text, type = 'default') {
        const p = document.createElement('p');
        p.innerText = `> ${text}`;
        if (type === 'error') p.className = 'text-mod-red font-black uppercase mt-4 border-l-4 border-mod-red pl-4';
        if (type === 'success') p.className = 'text-mod-green font-black uppercase mt-4 border-l-4 border-mod-green pl-4';
        if (type === 'white') p.className = 'text-white font-black uppercase mt-4';
        logs.appendChild(p);
        while(logs.children.length > 15) logs.removeChild(logs.firstChild);
    }

    input.addEventListener('keypress', async function (e) {
        if (e.key === 'Enter') {
            const code = this.value.toUpperCase();
            this.value = '';
            if(!code) return;

            addLog(`KEY_SEQ: ${code.substring(0,2)}****...`, 'white');

            const msgUint8 = new TextEncoder().encode(code);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');

            const HQ_AUTH_KEY = '8a054bcd07afcf1c2aad9fb9547ec94e83735f0cc38cafbe0bd11def265608f8';
            const CTF_KEYWORDS = ['TFA-ALPHA-01', 'SIGINT-RECON', 'GHOST-OPERATOR', 'NORTHWOOD', 'ZERO-TRUST', 'RECON-5-0', 'SABRE-3-0'];

            setTimeout(() => {
                if (hashHex === HQ_AUTH_KEY) {
                    addLog('ACCESS_GRANTED: DIRECTORATE_OVERSIGHT', 'success');
                    localStorage.setItem('uksf_auth', 'authorized');
                    localStorage.setItem('uksf_hq_auth', 'true');
                    setTimeout(() => window.location.href = '/registry/admin/', 1000);
                } else if (CTF_KEYWORDS.includes(code)) {
                    addLog('ACCESS_GRANTED: FIELD_INTEL_OP', 'success');
                    localStorage.setItem('uksf_auth', 'authorized');
                    localStorage.setItem('uksf_hq_auth', 'false');
                    setTimeout(() => window.location.href = '/registry/intelligence/', 1000);
                } else {
                    addLog('ERR: SECURITY_VIOLATION_KEY_INVALID', 'error');
                    input.classList.add('shake');
                    setTimeout(() => input.classList.remove('shake'), 500);
                }
            }, 800);
        }
    });
</script>
{{ end }}