{{ define "main" }}
<div class="workstation-container bg-[var(--bg-page)] transition-colors duration-300 relative">
    <!-- Background Grid -->
    <div class="absolute inset-0 z-0 pointer-events-none opacity-[0.05]" 
         style="background-image: linear-gradient(to right, #bfc1c3 1px, transparent 1px), linear-gradient(to bottom, #bfc1c3 1px, transparent 1px); background-size: 80px 80px;"></div>

    <!-- HUD Header -->
    <div class="absolute top-0 left-0 w-full h-16 bg-white/80 dark:bg-mod-black/80 backdrop-blur-xl border-b border-mod-grey-3 dark:border-mod-grey-1 z-50 flex items-center justify-between px-10">
        <div class="flex items-center gap-8">
            <a href="/registry/admin/" class="group p-2.5 border border-mod-grey-3 dark:border-mod-grey-1 hover:bg-mod-purple transition-all shadow-sm">
                <svg class="w-5 h-5 text-mod-purple group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            </a>
            <div class="flex flex-col">
                <span class="text-lg font-black text-mod-black dark:text-white uppercase font-industrial leading-none tracking-tight">Order of Battle</span>
                <span class="text-[9px] font-mono text-mod-purple dark:text-mod-grey-3 uppercase tracking-[0.4em] font-bold mt-1">v2.1 // JSFC_STRATEGIC_VIEW</span>
            </div>
        </div>
        
        <div class="flex items-center gap-10">
            <div class="flex flex-col items-end gap-1">
                <span class="text-[8px] font-mono text-mod-grey-2 uppercase tracking-widest font-black">Theater_Integrity</span>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-mod-green rounded-full shadow-[0_0_8px_rgba(0,112,60,0.4)]"></span>
                    <span class="text-[10px] font-mono font-black text-mod-green uppercase">SECURE_LINK</span>
                </div>
            </div>
            <div class="h-10 w-px bg-mod-grey-3 dark:bg-mod-grey-1"></div>
            <button onclick="window.saveToLocalStorage()" class="bg-mod-green text-white px-8 py-3.5 font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:-translate-y-0.5 transition-all">
                Commit_Orbat
            </button>
        </div>
    </div>

    <!-- 2. Interactive Canvas -->
    <div id="orbat-canvas" class="orbat-canvas-container cursor-grab active:cursor-grabbing h-full w-full pt-16">
        <div id="canvas-content" class="orbat-canvas-content">
            {{ partial "widgets/orbat.html" . }}
        </div>
    </div>

    <!-- Sidebar Controls -->
    <div class="absolute right-10 top-24 z-50 flex flex-col gap-4">
        <div class="bg-[var(--bg-page)] border border-mod-grey-3 dark:border-mod-grey-1 p-6 shadow-2xl space-y-6 min-w-[240px]">
            <span class="text-[10px] font-mono text-mod-purple uppercase tracking-[0.3em] block font-black border-b border-mod-grey-3 dark:border-mod-grey-1 pb-3">// Interface_Cfg</span>
            <div class="flex flex-col gap-3">
                <button id="edit-mode-btn" class="flex items-center justify-between p-3 border border-mod-grey-3 dark:border-mod-grey-1 hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all group">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-mod-grey-2 group-hover:text-mod-black dark:group-hover:text-white">Edit Mode</span>
                    <svg class="w-4 h-4 text-mod-grey-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </button>
                <button onclick="addOrbatNode()" class="flex items-center justify-between p-3 border border-mod-grey-3 dark:border-mod-grey-1 hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all group">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-mod-grey-2 group-hover:text-mod-black dark:group-hover:text-white">Add Unit</span>
                    <svg class="w-4 h-4 text-mod-grey-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
                <button onclick="centerView()" class="flex items-center justify-between p-3 border border-mod-grey-3 dark:border-mod-grey-1 hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all group">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-mod-grey-2 group-hover:text-mod-black dark:group-hover:text-white">Center</span>
                    <svg class="w-4 h-4 text-mod-grey-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
            </div>
        </div>

        <div class="bg-[var(--bg-page)] border border-mod-grey-3 dark:border-mod-grey-1 p-2 shadow-2xl flex flex-col">
            <button onclick="adjustZoom(0.1)" class="w-12 h-12 flex items-center justify-center hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all font-mono text-2xl font-light text-mod-grey-2">+</button>
            <div class="h-px bg-mod-grey-3 dark:bg-mod-grey-1 mx-2"></div>
            <button onclick="resetCanvas()" class="w-12 h-12 flex items-center justify-center hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all text-mod-grey-2 font-black">âŠ™</button>
            <div class="h-px bg-mod-grey-3 dark:bg-mod-grey-1 mx-2"></div>
            <button onclick="adjustZoom(-0.1)" class="w-12 h-12 flex items-center justify-center hover:bg-mod-grey-4 dark:hover:bg-white/5 transition-all font-mono text-2xl font-light text-mod-grey-2">-</button>
        </div>
    </div>
</div>

<script src="{{ `js/orbat-canvas.js` | relURL }}"></script>
{{ end }}
