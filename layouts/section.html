{{ define "main" }}
{{ partial "hero.html" . }}

<div class="container-uksf py-24">
    
    <!-- 1. Sticky Technical Filter Rule -->
    <div class="sticky top-[100px] z-[100] bg-black/80 backdrop-blur-xl border-b border-white/5 py-8 mb-20">
        <div class="flex flex-wrap items-center gap-6" id="registry-filters">
            <span class="text-[9px] font-mono text-gray-600 uppercase tracking-[0.4em] font-black mr-4">Filter Domain:</span>
            <button data-filter="all" class="filter-btn active">All Logs</button>
            <button data-filter="sas" class="filter-btn">SAS Ops</button>
            <button data-filter="sbs" class="filter-btn">SBS Ops</button>
            <button data-filter="rangers" class="filter-btn">Ranger Ops</button>
            <button data-filter="sfsg" class="filter-btn">SFSG Ops</button>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-20">
        
        <!-- MAIN CONTENT: Registry Grid -->
        <main class="lg:col-span-12 space-y-12">
            <div class="flex items-center justify-between border-b border-white/5 pb-12 mb-8">
                <div class="space-y-4">
                    <div class="flex items-center space-x-6">
                        <div class="w-12 h-px bg-[var(--primary)]"></div>
                        <span class="sub-header m-0 uppercase">Operational Registry</span>
                    </div>
                    <h2 class="text-6xl font-black tracking-tighter uppercase">After-Action Reports</h2>
                </div>
                <div class="text-right">
                    <span class="text-[8px] font-mono text-gray-600 uppercase tracking-widest block mb-2">Total Dossiers Detected</span>
                    <span class="text-2xl font-black text-white font-mono" id="report-count">{{ len .Pages }}</span>
                </div>
            </div>

            <!-- THE GRID -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-white/5 border border-white/5" id="stories-grid">
                {{ range .Pages }}
                {{ $unit := .Params.unit | default "joint" }}
                <a href="{{ .RelPermalink }}" data-unit="{{ lower $unit }}" class="story-card group bg-black p-10 no-underline transition-all duration-500 hover:bg-[#080808] border-r border-b border-white/5">
                    <div class="flex flex-col h-full space-y-8">
                        <div class="flex justify-between items-start">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-mono text-[var(--primary)] uppercase tracking-widest font-black">ID: {{ upper (substr (sha256 .Title) 0 8) }}</span>
                                <span class="text-[7px] font-mono text-gray-600 uppercase tracking-widest mt-1">{{ upper $unit }} // Registry</span>
                            </div>
                            <span class="text-[8px] font-black text-white/20 uppercase tracking-[0.2em] border border-white/10 px-2 py-0.5">Restricted</span>
                        </div>
                        
                        <div class="flex-grow">
                            <h3 class="text-3xl m-0 group-hover:text-white transition-colors uppercase font-black tracking-tighter leading-tight">{{ .Title }}</h3>
                            <p class="text-sm text-gray-500 font-light leading-relaxed mt-4 line-clamp-3 italic">"{{ .Description | default .Summary }}"</p>
                        </div>

                        <div class="pt-6 border-t border-white/5 flex items-center justify-between opacity-40 group-hover:opacity-100 transition-all">
                            <span class="text-[9px] font-black uppercase tracking-widest text-white">Access Archive</span>
                            <span class="text-white transform translate-x-[-10px] group-hover:translate-x-0 transition-transform">â†’</span>
                        </div>
                    </div>
                </a>
                {{ end }}
            </div>
        </main>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const filters = document.querySelectorAll('.filter-btn');
    const stories = document.querySelectorAll('.story-card');
    const countDisplay = document.getElementById('report-count');

    filters.forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.getAttribute('data-filter');
            
            // Update Active State
            filters.forEach(f => f.classList.remove('active', '!text-white'));
            btn.classList.add('active', '!text-white');

            let visibleCount = 0;

            stories.forEach(card => {
                if (filter === 'all' || card.getAttribute('data-unit') === filter) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            countDisplay.innerText = visibleCount;
        });
    });
});
</script>
{{ end }}
