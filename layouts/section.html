{{ define "main" }}
{{ partial "hero.html" . }}

<div class="container-uksf py-24">
    
    <!-- 1. Technical Filter Bar -->
    <div class="flex flex-wrap items-center gap-6 border-b border-white/5 pb-12 mb-20" id="registry-filters">
        <span class="text-[9px] font-mono text-gray-600 uppercase tracking-[0.4em] font-black mr-4">Filter_Domain:</span>
        <button data-filter="all" class="filter-btn active">All_Logs</button>
        <button data-filter="sas" class="filter-btn">SAS_Ops</button>
        <button data-filter="sbs" class="filter-btn">SBS_Ops</button>
        <button data-filter="rangers" class="filter-btn">Ranger_Ops</button>
        <button data-filter="sfsg" class="filter-btn">SFSG_Ops</button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-20">
        
        <!-- MAIN CONTENT: Registry Feed -->
        <main class="lg:col-span-8 space-y-12">
            <div class="space-y-8 mb-16">
                <div class="flex items-center space-x-6">
                    <div class="w-12 h-px bg-[var(--primary)]"></div>
                    <span class="sub-header m-0 uppercase">Operational_Registry</span>
                </div>
                <h2 class="text-6xl font-black tracking-tighter uppercase">After-Action <br>Reports</h2>
            </div>

            <div class="grid grid-cols-1 gap-8" id="stories-grid">
                {{ range .Pages }}
                {{ $unit := .Params.unit | default "joint" }}
                <a href="{{ .RelPermalink }}" data-unit="{{ lower $unit }}" class="story-card bracket-box group bg-white/[0.01] hover:bg-white/[0.03] border-white/5 hover:border-[var(--primary)]/30 no-underline transition-all duration-500">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-10 items-center">
                        <div class="md:col-span-3 space-y-6">
                            <div class="flex items-center space-x-4">
                                <span class="text-[9px] font-mono text-[var(--primary)] uppercase tracking-widest font-black">NODE ID: {{ upper (substr (sha256 .Title) 0 8) }}</span>
                                <span class="h-px w-8 bg-white/10"></span>
                                <span class="text-[8px] font-mono text-gray-600 uppercase tracking-widest">{{ upper $unit }} // REGISTRY</span>
                            </div>
                            <h3 class="text-4xl m-0 group-hover:text-white transition-colors uppercase font-black tracking-tighter">{{ .Title }}</h3>
                            <p class="text-sm text-gray-500 font-light leading-relaxed line-clamp-2 italic">"{{ .Description | default .Summary }}"</p>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] font-black uppercase tracking-widest text-white border-b border-white/10 group-hover:border-[var(--primary)] pb-2 transition-all">Access Dossier â†’</span>
                        </div>
                    </div>
                </a>
                {{ end }}
            </div>
        </main>

        <!-- SIDEBAR: Intelligence Status -->
        <aside class="lg:col-span-4 space-y-12">
            <div class="bracket-box bg-black/40 backdrop-blur-xl border-white/5 sticky top-48">
                <div class="space-y-10">
                    <div>
                        <h4 class="text-[10px] font-mono text-[var(--primary)] uppercase tracking-[0.4em] mb-6 font-bold">Registry Status</h4>
                        <div class="flex items-center space-x-4 bg-green-500/10 border border-green-500/20 px-6 py-4">
                            <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-[10px] font-black text-green-500 tracking-widest uppercase">Database Online</span>
                        </div>
                    </div>

                    <div class="space-y-6 border-t border-white/5 pt-10">
                        <div class="flex flex-col">
                            <span class="text-[8px] font-mono text-gray-600 uppercase tracking-widest">Archive Type</span>
                            <span class="text-xs font-bold text-white uppercase mt-1">Operational History</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[8px] font-mono text-gray-600 uppercase tracking-widest">Total Reports</span>
                            <span class="text-xs font-bold text-[var(--primary)] uppercase mt-1" id="report-count">{{ len .Pages }} Classified Entries</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const filters = document.querySelectorAll('.filter-btn');
    const stories = document.querySelectorAll('.story-card');
    const countDisplay = document.getElementById('report-count');

    filters.forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.getAttribute('data-filter');
            
            // Update Active State
            filters.forEach(f => f.classList.remove('active', '!text-white'));
            btn.classList.add('active', '!text-white');

            let visibleCount = 0;

            stories.forEach(card => {
                if (filter === 'all' || card.getAttribute('data-unit') === filter) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            countDisplay.innerText = `${visibleCount} Classified Entries`;
        });
    });
});
</script>
{{ end }}
