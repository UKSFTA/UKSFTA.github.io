name: Lint

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  commit-lint:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check Commit Messages
        uses: wagoid/commitlint-github-action@v5

  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Validate Config
        run: |
          CHECKER=".uksf_tools/tools/config_style_checker.py"
          if [ ! -f "$CHECKER" ]; then CHECKER="tools/config_style_checker.py"; fi
          python3 "$CHECKER"

      - name: Validate Stringtables
        run: python3 tools/stringtable_validator.py

      - name: Validate SQF
        run: python3 tools/sqf_validator.py

      - name: Validate Return Types
        run: python3 tools/return_checker.py

      - name: Validate Unused Variables
        run: python3 tools/search_unused_privates.py
